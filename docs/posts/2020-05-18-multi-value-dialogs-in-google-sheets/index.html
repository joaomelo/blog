<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">

    <style>
        

        /**
        * okaidia theme for JavaScript, CSS and HTML
        * Loosely based on Monokai textmate theme by http://www.monokai.nl/
        * @author ocodia
        */    

        code[class*="language-"],
        pre[class*="language-"] {
          color: #f8f8f2;
          background: none;
          text-shadow: 0 1px rgba(0, 0, 0, 0.3);
          font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
          font-size: 1em;
          text-align: left;
          white-space: pre;
          word-spacing: normal;
          word-break: normal;
          word-wrap: normal;
          line-height: 1.5;

          -moz-tab-size: 4;
          -o-tab-size: 4;
          tab-size: 4;

          -webkit-hyphens: none;
          -moz-hyphens: none;
          -ms-hyphens: none;
          hyphens: none;
        }

        /* Code blocks */
        pre[class*="language-"] {
          padding: 1em;
          margin: .75em 1rem 0;
          overflow: auto;
          border-radius: 0.3em;
        }

        :not(pre) > code[class*="language-"],
        pre[class*="language-"] {
          background: #272822;
        }

        /* Inline code */
        :not(pre) > code[class*="language-"] {
          padding: .1em;
          border-radius: .3em;
          white-space: normal;
        }

        .token.comment,
        .token.prolog,
        .token.doctype,
        .token.cdata {
          color: slategray;
        }

        .token.punctuation {
          color: #f8f8f2;
        }

        .token.namespace {
          opacity: .7;
        }

        .token.property,
        .token.tag,
        .token.constant,
        .token.symbol,
        .token.deleted {
          color: #f92672;
        }

        .token.boolean,
        .token.number {
          color: #ae81ff;
        }

        .token.selector,
        .token.attr-name,
        .token.string,
        .token.char,
        .token.builtin,
        .token.inserted {
          color: #a6e22e;
        }

        .token.operator,
        .token.entity,
        .token.url,
        .language-css .token.string,
        .style .token.string,
        .token.variable {
          color: #f8f8f2;
        }

        .token.atrule,
        .token.attr-value,
        .token.function,
        .token.class-name {
          color: #e6db74;
        }

        .token.keyword {
          color: #66d9ef;
        }

        .token.regex,
        .token.important {
          color: #fd971f;
        }

        .token.important,
        .token.bold {
          font-weight: bold;
        }
        .token.italic {
          font-style: italic;
        }

        .token.entity {
          cursor: help;
        }
    </style>

    <title>blog.melo.plus</title>
  </head>
  <body class="bg-green-100 text-gray-700">
    

<div class="min-h-screen max-w-screen-sm mx-auto px-4 bg-white">
  <header class="text-right"><a href="/" target="_self" class="font-semibold text-gray-700 rounded-full hover:text-green-400">home</a></header>
  <main>
    

<article>
  
  <h1 class="text-center text-3xl font-semibold capitalize">Multi-value Dialogs in Google Sheets</h1>

  <p class="text-xs text-center"><time datetime="2020-05-18T03:00:00.000Z">May 18, 2020</time></p>
  <div class="mt-4 text-justify">
  <p class="mt-3">Spreadsheets are probably the most ubiquitous digital tools in offices around the world. Many of us have a love and hate relationship with them.</p>
<p class="mt-3">One of the things I missed in then for a long time was the ability to select multiples values for a cell. An emulation of one-to-many relationships between different data sets so common in many apps.</p>
<p class="mt-3">Since Google Sheets support scripting using Html and JavaScript, it is quite accessible for web developers to implement that feature in their spreadsheets.</p>
<h2 class="text-xl font-semibold capitalize mt-4">Prepare The Data</h2>
<p class="mt-3">First, we create a simple example with datasheets for people and team records. In our case, a person can be part of more than one team.</p>
<p class="mt-3">Populate the data in both sheets and set the <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">Data validation</em> option in the people sheet for the teams' value range. This link will be crucial to our script later.</p>
<p class="mt-3"><img src="data-preparation.gif" alt="data preparation" class="p-4 w-full"></p>
<h2 class="text-xl font-semibold capitalize mt-4">Raising a Menu in The Spreadsheet</h2>
<p class="mt-3">Now click in the <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">Script Editor</em> submenu inside the <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">Tools</em> menu. After the script editor screen opens, click in <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">File</em>, then <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">New</em>, and finally in <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">Script file</em>. You can name the file whatever you want, but let us stick with <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">index</em> for this post.</p>
<p class="mt-3">The first step is to write some code to create a menu option in the spreadsheet so we can use that to call our future dialog. We do that by creating an <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">onOpen</em> function. This name is noted by the spreadsheet and called automatically whenever it opens.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">onOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> ss <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveSpreadsheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> multiselectMenu <span class="token operator">=</span> <span class="token punctuation">{</span> <br>    name<span class="token operator">:</span> <span class="token string">'Select multiple'</span><span class="token punctuation">,</span> <br>    functionName<span class="token operator">:</span> <span class="token string">'showSelectDialog'</span><br>  <span class="token punctuation">}</span><br>  ss<span class="token punctuation">.</span><span class="token function">addMenu</span><span class="token punctuation">(</span><span class="token string">"My Scripts"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> multiselectMenu <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p class="mt-3">For this time only, you need to reload the spreadsheet window after saving the script. The <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">My Script</em> menu should be available after that.</p>
<h2 class="text-xl font-semibold capitalize mt-4">Hello World</h2>
<p class="mt-3">The Apps Scripts technology offers an <a href="https://developers.google.com/apps-script/guides/html" class="font-semibold text-gray-700 hover:text-green-400">Html service</a> that can render custom dialogs and sidebars on top of Google apps. This is great because we can leverage standard Html, CSS, and JavaScript together with their API to create a new layer of features over Google spreadsheets, for example.</p>
<p class="mt-3">Let's create an Html file named <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">dialog</em> in the scripts editor to start exploring this feature. By inserting the code below in the <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">dialog</em> file we have a basic custom dialog.</p>
<pre class="language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Hello World!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <br>      <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cancel<span class="token punctuation">"</span></span> <br>      <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>google.script.host.close()<span class="token punctuation">"</span></span><br>    <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<p class="mt-3">Unfortunately, we have no way to invoke the dialog UI. Until now ðŸ˜‰.</p>
<p class="mt-3">To call the dialog, we need to go back to our <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">index</em> file and create a <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">showSelectDialog</em> function with the code below. You can see that the function hints to a template engine capability. This will be very useful to us in a moment.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">showSelectDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>  <span class="token keyword">const</span> template <span class="token operator">=</span> HtmlService<br>    <span class="token punctuation">.</span><span class="token function">createTemplateFromFile</span><span class="token punctuation">(</span><span class="token string">'dialog'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> html <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  SpreadsheetApp<br>    <span class="token punctuation">.</span><span class="token function">getUi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">showModalDialog</span><span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">'Select multiple'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p class="mt-3">We can test the dialog now. Our Hello World should appear whenever we click in the <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">Select multiple</em> menu. Google Sheets will probably ask you for authorization to run the script. This could happen more than once during this project. Make sure everything sounds safe and click ok for the scripts to work.</p>
<h2 class="text-xl font-semibold capitalize mt-4">Inject Available Options</h2>
<p class="mt-3">The challenge now is to settle how to show all teams as options for the user to select. We can also create a mechanism to check if some teams are present in the cell and show them already selected for the user.</p>
<p class="mt-3">We need another function inside <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">index</em> that uses the validation data for a cell as a database for available options. The function could also check if any of the options are already present in the cell and mark those as selected. Happily, Apps Scripts API does most of the heavy lifting for us. See the function.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getOptionsFromCurrentCell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>  <span class="token keyword">const</span> validOptions <span class="token operator">=</span> SpreadsheetApp<br>    <span class="token punctuation">.</span><span class="token function">getActiveRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// everything that is selected</span><br>    <span class="token punctuation">.</span><span class="token function">getDataValidation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// all validation rules for that</span><br>    <span class="token punctuation">.</span><span class="token function">getCriteriaValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// the first criteria</span><br>    <span class="token punctuation">.</span><span class="token function">getValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// the value for this criteria</span><br>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=></span> value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// flatten array data</span><br><br>  <span class="token keyword">const</span> selectedOptions <span class="token operator">=</span> SpreadsheetApp<br>    <span class="token punctuation">.</span><span class="token function">getActiveRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// first selected cell in the range</span><br>    <span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span> <span class="token comment">// convert the cell string into an array</span><br>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">str</span> <span class="token operator">=></span> str<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// remove unwanted whitespace</span><br>  <br>  <span class="token keyword">const</span> optionsData <span class="token operator">=</span> validOptions<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">option</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token punctuation">{</span><br>      value<span class="token operator">:</span> option<span class="token punctuation">,</span><br>      isSelected<span class="token operator">:</span> selectedOptions<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>  <span class="token keyword">return</span> optionsData<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p class="mt-3">The Apps Script template engine let us inject data in templates before rendering them. The data can then be used inside the template code. Now we update the <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">showSelectDialog</em> function to pass the options data we grab in the <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">getOptionsFromCurrentCell</em>. Let me show you.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">showSelectDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>  <span class="token keyword">const</span> template <span class="token operator">=</span> HtmlService<br>    <span class="token punctuation">.</span><span class="token function">createTemplateFromFile</span><span class="token punctuation">(</span><span class="token string">'dialog'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// pass options data to the template </span><br>  template<span class="token punctuation">.</span>optionsData <span class="token operator">=</span> <span class="token function">getOptionsFromCurrentCell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> html <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  SpreadsheetApp<br>    <span class="token punctuation">.</span><span class="token function">getUi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">showModalDialog</span><span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">'Select multiple'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h2 class="text-xl font-semibold capitalize mt-4">Render the Dialog</h2>
<p class="mt-3">Now we need to use that options data inside our template to render checkboxes for every option. The Apps Script template engine behaves like other typical JavaScript template languages. Details can be found <a href="https://developers.google.com/apps-script/guides/html/templates" class="font-semibold text-gray-700 hover:text-green-400">here</a>.</p>
<p class="mt-3">We revisit the <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">dialog</em> file to render the checkboxes using <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">&lt;?= ?&gt;</em> and <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">&lt;? ?&gt;</em> special syntax as way to embed JavaScript inside the Html. Then use a standard script tag to write a function to clear or select all items.</p>
<pre class="language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token prolog">&lt;? for (const option of optionsData) { ?></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;?= option.value ?><span class="token punctuation">"</span></span> <br>        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>option<span class="token punctuation">"</span></span><br>        <span class="token attr-name">&lt;?</span><span class="token attr-value"><span class="token punctuation">=</span> option.isSelected</span> <span class="token attr-name">&amp;&amp;</span> <span class="token attr-name">"checked"</span> <span class="token attr-name">?</span><span class="token punctuation">></span></span><br>      ><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span><span class="token prolog">&lt;?= option.value ?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><br>    <span class="token prolog">&lt;? } ?></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">margin-top</span><span class="token punctuation">:</span>10px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>all<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setAll('check')<span class="token punctuation">"</span></span> <br>      <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>clear<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setAll('clear')<span class="token punctuation">"</span></span> <br>      <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cancel<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>google.script.host.close()<span class="token punctuation">"</span></span><br>      <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">      <br>      <span class="token keyword">function</span> <span class="token function">setAll</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> optionsEl <span class="token operator">=</span> document<br>          <span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">".option"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> checkbox <span class="token keyword">of</span> optionsEl<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          checkbox<span class="token punctuation">.</span>checked <span class="token operator">=</span> value <span class="token operator">===</span> <span class="token string">'check'</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<p class="mt-3">Now, the spreadsheet should show all teams when the menu is selected. Notice that the logic is not tied to any particular data. It is based on the validation criteria of the selected cell. Things are starting to get real ðŸ˜Ž.</p>
<p class="mt-3">But we still need a way to send the user-selected options back to the spreadsheet. Google considers the dialog we develop a client app and both the spreadsheet itself and the functions we wrote in the <code>index</code> file as the server counterpart. So we need a bridge to communicate back to the server what the user selected. Gladly Apps Script makes it quite simple.</p>
<h2 class="text-xl font-semibold capitalize mt-4">Update Based on User Selection</h2>
<p class="mt-3">First, let's write a new function in the <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">index</em> file that receives an array of choices as a parameter and set that content in the currently selected cell.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">setOptionsForCurrentCell</span><span class="token punctuation">(</span><span class="token parameter">selectedOptions</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>  <span class="token keyword">const</span> hasOptions <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>selectedOptions<span class="token punctuation">)</span> <br>    <span class="token operator">&amp;&amp;</span> selectedOptions<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><br>  <span class="token keyword">const</span> cellData <span class="token operator">=</span> hasOptions<br>    <span class="token comment">// creates a comma separated string</span><br>    <span class="token operator">?</span> selectedOptions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><br>    <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> cell <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  cell<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>cellData<span class="token punctuation">)</span><span class="token punctuation">;</span>  <br><span class="token punctuation">}</span></code></pre>
<p class="mt-3">Now we update the Html file to create a button and a new function that pass the that to <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">setOptionsForCurrentCell</em>.</p>
<pre class="language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token prolog">&lt;? for (const option of optionsData) { ?></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>option<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;?= option.value ?><span class="token punctuation">"</span></span> <br>        <span class="token attr-name">&lt;?</span><span class="token attr-value"><span class="token punctuation">=</span> option.isSelected</span> <span class="token attr-name">&amp;&amp;</span> <span class="token attr-name">"checked"</span> <span class="token attr-name">?</span><span class="token punctuation">></span></span><br>      ><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span><span class="token prolog">&lt;?= option.value ?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><br>    <span class="token prolog">&lt;? } ?></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">margin-top</span><span class="token punctuation">:</span>10px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>all<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setAll('check')<span class="token punctuation">"</span></span><br>      <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>clear<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setAll('clear')<span class="token punctuation">"</span></span> <br>      <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><br>        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cancel<span class="token punctuation">"</span></span><br>        <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>google.script.host.close()<span class="token punctuation">"</span></span><br>      <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><br>        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>apply<span class="token punctuation">"</span></span><br>        <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>apply()<span class="token punctuation">"</span></span><br>      <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">      <br>      <span class="token keyword">function</span> <span class="token function">setAll</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> optionsEl <span class="token operator">=</span> document<br>          <span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">".option"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> checkbox <span class="token keyword">of</span> optionsEl<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          checkbox<span class="token punctuation">.</span>checked <span class="token operator">=</span> value <span class="token operator">===</span> <span class="token string">'check'</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><br><br>      <span class="token keyword">function</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> checkedEls <span class="token operator">=</span> document<br>          <span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">".option:checked"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">const</span> selectedValues <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> checkbox <span class="token keyword">of</span> checkedEls<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token keyword">if</span> <span class="token punctuation">(</span>checkbox<span class="token punctuation">.</span>checked<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>             selectedValues<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>checkbox<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>        google<span class="token punctuation">.</span>script<span class="token punctuation">.</span>run<br>          <span class="token punctuation">.</span><span class="token function">setOptionsForCurrentCell</span><span class="token punctuation">(</span>selectedValues<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        google<span class="token punctuation">.</span>script<span class="token punctuation">.</span>host<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<p class="mt-3">You can can see in the <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">apply</em> function that we called <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">setOptionsForCurrentCell</em> via <em class="text-xs bg-gray-200 font-mono py-1 px-2 rounded-sm not-italic">google.script.run</em>. This is an asynchronous operation provided by the Apps Scripts API that offers other options like handlers for failed or successful calls. You can read more about it <a href="https://developers.google.com/apps-script/guides/html/reference/run" class="font-semibold text-gray-700 hover:text-green-400">here</a>.</p>
<p class="mt-3">By now our program should be working just fine, even if not very visually elegant.</p>
<p class="mt-3"><img src="dialog-working.gif" alt="dialog is now working" class="p-4 w-full"></p>
<p class="mt-3">We can improve upon what we did until here by styling the dialog and creating better UI feedback. You will see that if we select the menu while in a cell without validation criteria, the user will get a confusing exception message. We also could deal better with the asynchronous aspects. But I will leave that outside the scope of this post. Maybe you can give some suggestions in the GitHub repository.</p>
<p class="mt-3">Talking about that, you can find the full code for this project in this <a href="https://github.com/joaomelo/dialog-to-select-multiple-values-in-google-sheets" class="font-semibold text-gray-700 hover:text-green-400">GitHub repository</a>.</p>

  </div>
</article>
  </main>
  <footer>
    <section class="mt-8 flex flex-wrap justify-center">
      
        
  <a href="/tags/google apps script/" class="font-semibold text-gray-700 rounded-full bg-green-200 hover:bg-green-400 px-2 mx-1 my-1">google apps script</a>
      
    </section>
    <p class="mt-8 mx-8 p-4 text-justify font-mono border-dashed border-4 border-gray-700">Hi! My name is JoÃ£o Melo. I am an enthusiast of how leadership and technology combine to create amazing things together ðŸ¤“. I decided to blog about it as I learn what I can. You can get updates from <a href="https://twitter.com/joaomeloplus" target="_blank" class="font-semibold text-gray-700 rounded-full hover:text-green-400">Twitter</a>, and also find me on <a href="https://github.com/joaomelo" target="_blank" class="font-semibold text-gray-700 rounded-full hover:text-green-400">GitHub</a> or <a href="https://www.linkedin.com/in/joaomelo81/?locale=en_US" target="_blank" class="font-semibold text-gray-700 rounded-full hover:text-green-400">LinkedIn</a></p>
    <p class="text-center mt-8 text-xs">content here is copylefted under <a href="https://choosealicense.com/licenses/cc-by-sa-4.0/" target="_blank" class="font-semibold text-gray-700 rounded-full hover:text-green-400">CC-BY-SA-4.0</a></p>
    <br/>
  </footer>
</div>

  </body>
</html>