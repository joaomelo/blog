<!DOCTYPE html>
<html lang="en">
  <head>
    
      <!-- Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-128497960-2"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-128497960-2');
      </script>
      

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    
      <meta name="twitter:card" content="summary_large_image">
    
      <meta name="twitter:title" content="Dev Workflow with Firebase Auto Hosting URLs">
    
      <meta name="twitter:image" content="https://blog.melo.plus\media\2020-07-02-dev-workflow-with-firebase-auto-hosting-urls-cover.png">
    

    <link rel="icon" type="image/png" href="/media/favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&family=Roboto:wght@400;900&display=swap" rel="stylesheet">
    <link href="/styles/index.css" rel="stylesheet">

    <title>blog.melo.plus</title>
  </head>
  <body>
    

    <header>
      <h1>
        <a href="/" target="_self">melo.plus</a> 
          
      </h1>
    </header>

    <div class="container">
      <main>
        

<div>
  
  <h1 class="page-title">Dev Workflow with Firebase Auto Hosting URLs</h1>

  <p class="post-date"><time datetime="2020-07-02T03:00:00.000Z">July 2, 2020</time></p>
  <p></p>
  <article class="post-content">
    <p class="post-paragraph">If you've been using <a href="https://firebase.google.com">Firebase</a> in your JavaScript projects for some time, there is a good chance you link your app to Firebase using a configuration object. First installing the Firebase <a href="https://www.npmjs.com/package/firebase">npm package</a>, then importing and using it in the source code similarly to the instructions below.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> firebase <span class="token keyword">from</span> <span class="token string">'firebase/app'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'firebase/auth'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'firebase/firestore'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span><br>  apiKey<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">FIREBASE_API_KEY</span><span class="token punctuation">,</span><br>  authDomain<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">FIREBASE_AUTH_DOMAIN</span><span class="token punctuation">,</span><br>  databaseURL<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">FIREBASE_DATABASE_URL</span><span class="token punctuation">,</span><br>  projectId<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">FIREBASE_PROJECT_ID</span><span class="token punctuation">,</span><br>  storageBucket<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">FIREBASE_STORAGE_BUCKET</span><span class="token punctuation">,</span><br>  messagingSenderId<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">FIREBASE_MSG_SENDER_ID</span><span class="token punctuation">,</span><br>  appId<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">FIREBASE_APP_ID</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> fireapp <span class="token operator">=</span> firebase<span class="token punctuation">.</span><span class="token function">initializeApp</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> fireauth <span class="token operator">=</span> fireapp<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> firedb <span class="token operator">=</span> fireapp<span class="token punctuation">.</span><span class="token function">firestore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token punctuation">{</span> fireapp<span class="token punctuation">,</span> fireauth<span class="token punctuation">,</span> firedb <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p class="post-paragraph">There is nothing wrong with that, but it is good to know there are other options that can potentially reduce boilerplate and risk of errors in our apps.</p>
<h2 class="post-subtitle">The Three Options To Add Firebase</h2>
<p class="post-paragraph">At the time of this writing, there are three options to link Firebase to a JavaScript web project. You can always check them in <a href="https://firebase.google.com/docs/web/setup#add-sdks-initialize">Firebase docs</a>. In short, the first one was mentioned in the post introduction.</p>
<p class="post-paragraph">The second option uses a CDN to import Firebase SDKs. Instead of installing an npm package, we insert the corresponding CDN links in the HTML code. Then, manually set up the config object like in the first option.</p>
<p class="post-paragraph">Thirdly, we insert some unique URLs in the HTML. But unlike the CDN approach, Firebase hosting servers react to those URLs and take care not just with importing SDKs, but also automatically activating the proper project configuration.</p>
<p class="post-paragraph">I want to analyze these Auto Hosting URLs in more detail. Let's start by making sure how to put them in motion and then explore how they affect development workflow.</p>
<h2 class="post-subtitle">Auto Hosting URLs Reduce Code Footprint</h2>
<p class="post-paragraph">If you host your app with Firebase, its servers will already know during runtime what project that code belongs to. The job of grabbing all the configuration data and securely inject it into the app becomes straightforward for them. What it needs from you is what SDKs versions you want to use. We signal that with those magical URLs. Check it out.</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>  <span class="token comment">&lt;!-- start: firebase --></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/__/firebase/7.15.5/firebase-app.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token comment">&lt;!-- feature specific modules  --></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/__/firebase/7.15.5/firebase-auth.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/__/firebase/7.15.5/firebase-firestore.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token comment">&lt;!-- full list of SDKs here https://bit.ly/3dLSmTO --></span><br>  <span class="token comment">&lt;!-- config initialization --></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/__/firebase/init.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <br>  <span class="token comment">&lt;!-- end: firebase --></span><br><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Hello World!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre>
<p class="post-paragraph">After the scripts are loaded, Firebase will be available as a global variable in our app. We can implement some encapsulation and create a central module from which others can import. It will be a small js file like this.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> fireapp <span class="token operator">=</span> firebase<span class="token punctuation">.</span><span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> fireauth <span class="token operator">=</span> fireapp<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> firedb <span class="token operator">=</span> fireapp<span class="token punctuation">.</span><span class="token function">firestore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token punctuation">{</span> fireapp<span class="token punctuation">,</span> fireauth<span class="token punctuation">,</span> firedb <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p class="post-paragraph">Even with this step (which I recommend), we have a smaller code footprint. But the benefits don't end here.</p>
<h2 class="post-subtitle">Easier Project Switch</h2>
<p class="post-paragraph">An everyday use case is to keep multiple Firebase projects for the same app. One for development, other for production, maybe even inserting a staging project, could be a good idea depending on how critical the app is. The point is to preserve production data and avoid errors during releases.</p>
<p class="post-paragraph">With the approach based on config objects, we have to find a way to manage the decision of which configuration data to use. A popular design is to create a <code>.env</code> file for each environment with corresponding Webpack (or another build tool) instructions to inject configuration as environment variables during build time.</p>
<p class="post-paragraph">As said before, that is absolutely fine, but since Firebase already knows your projects, we could leverage the service capability to take care of that data management.</p>
<p class="post-paragraph">For starts, since <code>.env</code> files are not suitable for git storage; they will have to be recreated after every project cloning, for example. I know it is not that much trouble, but with every keystroke comes an error opportunity. What if we copy the production data inside <code>.dev.env</code>?.</p>
<p class="post-paragraph">Another benefit is that continuous delivery becomes easier. Instead of having to figure a way to load configuration data on those services, we could limit ourselves to deal with just the project id. The example below is adapted from one of my GitHub repositories and illustrates the approach by using GitHub actions for continuous delivery to Firebase.</p>
<pre class="language-yml"><code class="language-yml"><span class="token comment"># ...some preceding configuration</span><br><span class="token key atrule">publish</span><span class="token punctuation">:</span><br>  <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest<br>  <span class="token key atrule">steps</span><span class="token punctuation">:</span><br>    <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2<br>      <span class="token key atrule">with</span><span class="token punctuation">:</span><br>        <span class="token key atrule">ref</span><span class="token punctuation">:</span> master<br>    <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v1<br>      <span class="token key atrule">with</span><span class="token punctuation">:</span><br>        <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token number">12</span><br>    <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm ci<br>    <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run build<br>    <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> w9jds/firebase<span class="token punctuation">-</span>action@master<br>      <span class="token key atrule">with</span><span class="token punctuation">:</span><br>        <span class="token key atrule">args</span><span class="token punctuation">:</span> deploy<br>      <span class="token key atrule">env</span><span class="token punctuation">:</span><br>        <span class="token key atrule">PROJECT_ID</span><span class="token punctuation">:</span> some<span class="token punctuation">-</span>project<span class="token punctuation">-</span>id<br>        <span class="token key atrule">FIREBASE_TOKEN</span><span class="token punctuation">:</span> $</code></pre>
<p class="post-paragraph">I recently decided to start using Firebase emulators for local development and also seized the opportunity to also implement the Hosting URLs. It gave me that warm feeling of lifting some (even if small) mental load. Well, I, too, enjoy playing with this kind of puzzles anyway ðŸ˜Š.</p>
<p class="post-paragraph">Thanks for the opportunity to share. I hope it helps.</p>

  </article>
</div>
      </main>
      <footer>
        <div class="tags">
          
            
  <a href="/tags/API/" class="content-tag">API</a>
          
            
  <a href="/tags/airtable/" class="content-tag">airtable</a>
          
            
  <a href="/tags/auth/" class="content-tag">auth</a>
          
            
  <a href="/tags/devops/" class="content-tag">devops</a>
          
            
  <a href="/tags/education/" class="content-tag">education</a>
          
            
  <a href="/tags/firebase/" class="content-tag">firebase</a>
          
            
  <a href="/tags/google apps script/" class="content-tag">google apps script</a>
          
            
  <a href="/tags/patterns/" class="content-tag">patterns</a>
          
            
  <a href="/tags/reactivity/" class="content-tag">reactivity</a>
          
        </div>
        <p class="about">Hi! My name is JoÃ£o Melo. I am enthusiastic about how determination and technology combine to create amazing things ðŸ¤“. I decided to blog about it as I learn what I can. You can get updates from <a href="https://twitter.com/joaomeloplus" target="_blank">Twitter</a>, and also find me on <a href="https://github.com/joaomelo" target="_blank">GitHub</a> or <a href="https://www.linkedin.com/in/joaomelo81/?locale=en_US" target="_blank">LinkedIn</a></p>          
        <p class="license">content here is copylefted under <a href="https://choosealicense.com/licenses/cc-by-sa-4.0/" target="_blank">CC-BY-SA-4.0</a></p>
      </footer>
    </div>
  </body>
</html>
