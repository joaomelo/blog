<!DOCTYPE html>
<html lang="en">
  <head>
    
      <!-- Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-128497960-2"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-128497960-2');
      </script>
      

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    
      <meta name="twitter:card" content="summary_large_image">
    
      <meta name="twitter:title" content="Multi-value Dialogs in Google Sheets">
    

    <link rel="icon" type="image/png" href="/media/favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&family=Roboto:wght@400;900&display=swap" rel="stylesheet">
    <link href="/styles/index.css" rel="stylesheet">

    <title>blog.melo.plus</title>
  </head>
  <body>
    

    <header>
      <h1>
        <a href="/" target="_self">melo.plus</a> 
          
      </h1>
    </header>

    <div class="container">
      <main>
        

<div>
  
  <h1 class="page-title">Multi-value Dialogs in Google Sheets</h1>

  <p class="post-date"><time datetime="2020-05-18T03:00:00.000Z">May 18, 2020</time></p>
  <p></p>
  <article class="post-content">
    <p class="post-paragraph">Spreadsheets are probably the most ubiquitous digital tools in offices around the world. Many of us have a love and hate relationship with them.</p>
<p class="post-paragraph">One of the things I missed in then for a long time was the ability to select multiples values for a cell. An emulation of one-to-many relationships between different data sets so common in many apps.</p>
<p class="post-paragraph">Since Google Sheets support scripting using Html and JavaScript, it is quite accessible for web developers to implement that feature in their spreadsheets.</p>
<h2 class="post-subtitle">Prepare The Data</h2>
<p class="post-paragraph">First, we create a simple example with datasheets for people and team records. In our case, a person can be part of more than one team.</p>
<p class="post-paragraph">Populate the data in both sheets and set the <code>Data validation</code> option in the people sheet for the teams' value range. This link will be crucial to our script later.</p>
<p class="post-paragraph"><img src="/media/2020-05-18-data-preparation.gif" alt="data preparation" class="post-image"></p>
<h2 class="post-subtitle">Raising a Menu in The Spreadsheet</h2>
<p class="post-paragraph">Now click in the <code>Script Editor</code> submenu inside the <code>Tools</code> menu. After the script editor screen opens, click in <code>File</code>, then <code>New</code>, and finally in <code>Script file</code>. You can name the file whatever you want, but let us stick with <code>index</code> for this post.</p>
<p class="post-paragraph">The first step is to write some code to create a menu option in the spreadsheet so we can use that to call our future dialog. We do that by creating an <code>onOpen</code> function. This name is noted by the spreadsheet and called automatically whenever it opens.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">onOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> ss <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveSpreadsheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> multiselectMenu <span class="token operator">=</span> <span class="token punctuation">{</span> <br>    name<span class="token operator">:</span> <span class="token string">'Select multiple'</span><span class="token punctuation">,</span> <br>    functionName<span class="token operator">:</span> <span class="token string">'showSelectDialog'</span><br>  <span class="token punctuation">}</span><br>  ss<span class="token punctuation">.</span><span class="token function">addMenu</span><span class="token punctuation">(</span><span class="token string">"My Scripts"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> multiselectMenu <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p class="post-paragraph">For this time only, you need to reload the spreadsheet window after saving the script. The <code>My Script</code> menu should be available after that.</p>
<h2 class="post-subtitle">Hello World</h2>
<p class="post-paragraph">The Apps Scripts technology offers an <a href="https://developers.google.com/apps-script/guides/html">Html service</a> that can render custom dialogs and sidebars on top of Google apps. This is great because we can leverage standard Html, CSS, and JavaScript together with their API to create a new layer of features over Google spreadsheets, for example.</p>
<p class="post-paragraph">Let's create an Html file named <code>dialog</code> in the scripts editor to start exploring this feature. By inserting the code below in the <code>dialog</code> file we have a basic custom dialog.</p>
<pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Hello World!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <br>      <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cancel<span class="token punctuation">"</span></span> <br>      <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript">google<span class="token punctuation">.</span>script<span class="token punctuation">.</span>host<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><br>    <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<p class="post-paragraph">Unfortunately, we have no way to invoke the dialog UI. Until now ðŸ˜‰.</p>
<p class="post-paragraph">To call the dialog, we need to go back to our <code>index</code> file and create a <code>showSelectDialog</code> function with the code below. You can see that the function hints to a template engine capability. This will be very useful to us in a moment.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">showSelectDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>  <span class="token keyword">const</span> template <span class="token operator">=</span> HtmlService<br>    <span class="token punctuation">.</span><span class="token function">createTemplateFromFile</span><span class="token punctuation">(</span><span class="token string">'dialog'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> html <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  SpreadsheetApp<br>    <span class="token punctuation">.</span><span class="token function">getUi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">showModalDialog</span><span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">'Select multiple'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p class="post-paragraph">We can test the dialog now. Our Hello World should appear whenever we click in the <code>Select multiple</code> menu. Google Sheets will probably ask you for authorization to run the script. This could happen more than once during this project. Make sure everything sounds safe and click ok for the scripts to work.</p>
<h2 class="post-subtitle">Inject Available Options</h2>
<p class="post-paragraph">The challenge now is to settle how to show all teams as options for the user to select. We can also create a mechanism to check if some teams are present in the cell and show them already selected for the user.</p>
<p class="post-paragraph">We need another function inside <code>index</code> that uses the validation data for a cell as a database for available options. The function could also check if any of the options are already present in the cell and mark those as selected. Happily, Apps Scripts API does most of the heavy lifting for us. See the function.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getOptionsFromCurrentCell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>  <span class="token keyword">const</span> validOptions <span class="token operator">=</span> SpreadsheetApp<br>    <span class="token punctuation">.</span><span class="token function">getActiveRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// everything that is selected</span><br>    <span class="token punctuation">.</span><span class="token function">getDataValidation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// all validation rules for that</span><br>    <span class="token punctuation">.</span><span class="token function">getCriteriaValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// the first criteria</span><br>    <span class="token punctuation">.</span><span class="token function">getValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// the value for this criteria</span><br>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=></span> value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// flatten array data</span><br><br>  <span class="token keyword">const</span> selectedOptions <span class="token operator">=</span> SpreadsheetApp<br>    <span class="token punctuation">.</span><span class="token function">getActiveRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// first selected cell in the range</span><br>    <span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span> <span class="token comment">// convert the cell string into an array</span><br>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">str</span> <span class="token operator">=></span> str<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// remove unwanted whitespace</span><br>  <br>  <span class="token keyword">const</span> optionsData <span class="token operator">=</span> validOptions<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">option</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token punctuation">{</span><br>      value<span class="token operator">:</span> option<span class="token punctuation">,</span><br>      isSelected<span class="token operator">:</span> selectedOptions<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>  <span class="token keyword">return</span> optionsData<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p class="post-paragraph">The Apps Script template engine let us inject data in templates before rendering them. The data can then be used inside the template code. Now we update the <code>showSelectDialog</code> function to pass the options data we grab in the <code>getOptionsFromCurrentCell</code>. Let me show you.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">showSelectDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>  <span class="token keyword">const</span> template <span class="token operator">=</span> HtmlService<br>    <span class="token punctuation">.</span><span class="token function">createTemplateFromFile</span><span class="token punctuation">(</span><span class="token string">'dialog'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// pass options data to the template </span><br>  template<span class="token punctuation">.</span>optionsData <span class="token operator">=</span> <span class="token function">getOptionsFromCurrentCell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> html <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  SpreadsheetApp<br>    <span class="token punctuation">.</span><span class="token function">getUi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">showModalDialog</span><span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">'Select multiple'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h2 class="post-subtitle">Render the Dialog</h2>
<p class="post-paragraph">Now we need to use that options data inside our template to render checkboxes for every option. The Apps Script template engine behaves like other typical JavaScript template languages. Details can be found <a href="https://developers.google.com/apps-script/guides/html/templates">here</a>.</p>
<p class="post-paragraph">We revisit the <code>dialog</code> file to render the checkboxes using <code>\&lt;?= ?&gt;</code> and <code>\&lt;? ?&gt;</code> special syntax as way to embed JavaScript inside the Html. Then use a standard script tag to write a function to clear or select all items.</p>
<pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token prolog">&lt;? for (const option of optionsData) { ?></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&lt;?= option.value ?><span class="token punctuation">"</span></span> <br>        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>option<span class="token punctuation">"</span></span><br>        <span class="token attr-name">&lt;?</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span> option.isSelected</span> <span class="token attr-name">&amp;&amp;</span> <span class="token attr-name">"checked"</span> <span class="token attr-name">?</span><span class="token punctuation">></span></span><br>      ><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span><span class="token prolog">&lt;?= option.value ?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><br>    <span class="token prolog">&lt;? } ?></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">margin-top</span><span class="token punctuation">:</span>10px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>all<span class="token punctuation">"</span></span> <br>        <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">setAll</span><span class="token punctuation">(</span><span class="token string">'check'</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span> <br>      <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>clear<span class="token punctuation">"</span></span> <br>        <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">setAll</span><span class="token punctuation">(</span><span class="token string">'clear'</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span> <br>      <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cancel<span class="token punctuation">"</span></span> <br>        <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript">google<span class="token punctuation">.</span>script<span class="token punctuation">.</span>host<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><br>      <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">      <br>      <span class="token keyword">function</span> <span class="token function">setAll</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> optionsEl <span class="token operator">=</span> document<br>          <span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">".option"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> checkbox <span class="token keyword">of</span> optionsEl<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          checkbox<span class="token punctuation">.</span>checked <span class="token operator">=</span> value <span class="token operator">===</span> <span class="token string">'check'</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<p class="post-paragraph">Now, the spreadsheet should show all teams when the menu is selected. Notice that the logic is not tied to any particular data. It is based on the validation criteria of the selected cell. Things are starting to get real ðŸ˜Ž.</p>
<p class="post-paragraph">But we still need a way to send the user-selected options back to the spreadsheet. Google considers the dialog we develop a client app and both the spreadsheet itself and the functions we wrote in the <code>index</code> file as the server counterpart. So we need a bridge to communicate back to the server what the user selected. Gladly Apps Script makes it quite simple.</p>
<h2 class="post-subtitle">Update Based on User Selection</h2>
<p class="post-paragraph">First, let's write a new function in the <code>index</code> file that receives an array of choices as a parameter and set that content in the currently selected cell.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">setOptionsForCurrentCell</span><span class="token punctuation">(</span><span class="token parameter">selectedOptions</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>  <span class="token keyword">const</span> hasOptions <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>selectedOptions<span class="token punctuation">)</span> <br>    <span class="token operator">&amp;&amp;</span> selectedOptions<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><br>  <span class="token keyword">const</span> cellData <span class="token operator">=</span> hasOptions<br>    <span class="token comment">// creates a comma separated string</span><br>    <span class="token operator">?</span> selectedOptions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><br>    <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> cell <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  cell<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>cellData<span class="token punctuation">)</span><span class="token punctuation">;</span>  <br><span class="token punctuation">}</span></code></pre>
<p class="post-paragraph">Now we update the Html file to create a button and a new function that pass the that to <code>setOptionsForCurrentCell</code>.</p>
<pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token prolog">&lt;? for (const option of optionsData) { ?></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>option<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&lt;?= option.value ?><span class="token punctuation">"</span></span> <br>        <span class="token attr-name">&lt;?</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span> option.isSelected</span> <span class="token attr-name">&amp;&amp;</span> <span class="token attr-name">"checked"</span> <span class="token attr-name">?</span><span class="token punctuation">></span></span><br>      ><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span><span class="token prolog">&lt;?= option.value ?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><br>    <span class="token prolog">&lt;? } ?></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">margin-top</span><span class="token punctuation">:</span>10px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>all<span class="token punctuation">"</span></span> <br>        <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">setAll</span><span class="token punctuation">(</span><span class="token string">'check'</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><br>      <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <br>        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>clear<span class="token punctuation">"</span></span> <br>        <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">setAll</span><span class="token punctuation">(</span><span class="token string">'clear'</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span> <br>      <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><br>        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cancel<span class="token punctuation">"</span></span><br>        <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript">google<span class="token punctuation">.</span>script<span class="token punctuation">.</span>host<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><br>      <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><br>        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>apply<span class="token punctuation">"</span></span><br>        <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><br>      <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">      <br>      <span class="token keyword">function</span> <span class="token function">setAll</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> optionsEl <span class="token operator">=</span> document<br>          <span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">".option"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> checkbox <span class="token keyword">of</span> optionsEl<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          checkbox<span class="token punctuation">.</span>checked <span class="token operator">=</span> value <span class="token operator">===</span> <span class="token string">'check'</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><br><br>      <span class="token keyword">function</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> checkedEls <span class="token operator">=</span> document<br>          <span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">".option:checked"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">const</span> selectedValues <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> checkbox <span class="token keyword">of</span> checkedEls<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token keyword">if</span> <span class="token punctuation">(</span>checkbox<span class="token punctuation">.</span>checked<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>             selectedValues<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>checkbox<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>        google<span class="token punctuation">.</span>script<span class="token punctuation">.</span>run<br>          <span class="token punctuation">.</span><span class="token function">setOptionsForCurrentCell</span><span class="token punctuation">(</span>selectedValues<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        google<span class="token punctuation">.</span>script<span class="token punctuation">.</span>host<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<p class="post-paragraph">You can can see in the <code>apply</code> function that we called <code>setOptionsForCurrentCell</code> via <code>google.script.run</code>. This is an asynchronous operation provided by the Apps Scripts API that offers other options like handlers for failed or successful calls. You can read more about it <a href="https://developers.google.com/apps-script/guides/html/reference/run">here</a>.</p>
<p class="post-paragraph">By now our program should be working just fine, even if not very visually elegant.</p>
<p class="post-paragraph"><img src="/media/2020-05-18-dialog-working.gif" alt="dialog is now working" class="post-image"></p>
<p class="post-paragraph">We can improve upon what we did until here by styling the dialog and creating better UI feedback. You will see that if we select the menu while in a cell without validation criteria, the user will get a confusing exception message. We also could deal better with the asynchronous aspects. But I will leave that outside the scope of this post. Maybe you can give some suggestions in the GitHub repository.</p>
<p class="post-paragraph">Talking about that, you can find the full code for this project in this <a href="https://github.com/joaomelo/dialog-to-select-multiple-values-in-google-sheets">GitHub repository</a>.</p>

  </article>
</div>
      </main>
      <footer>
        <div class="tags">
          
            
  <a href="/tags/airtable/" class="content-tag">airtable</a>
          
            
  <a href="/tags/api/" class="content-tag">api</a>
          
            
  <a href="/tags/auth/" class="content-tag">auth</a>
          
            
  <a href="/tags/devops/" class="content-tag">devops</a>
          
            
  <a href="/tags/education/" class="content-tag">education</a>
          
            
  <a href="/tags/firebase/" class="content-tag">firebase</a>
          
            
  <a href="/tags/github/" class="content-tag">github</a>
          
            
  <a href="/tags/google apps script/" class="content-tag">google apps script</a>
          
            
  <a href="/tags/patterns/" class="content-tag">patterns</a>
          
            
  <a href="/tags/reactivity/" class="content-tag">reactivity</a>
          
        </div>
        <p class="about">Hi! My name is JoÃ£o Melo ðŸ¤“. I am Enthusiastic about how collaboration and learning combine in the digital world to create amazing things. I decided to blog about it as I figure out what I can. You can get updates from <a href="https://twitter.com/joaomeloplus" target="_blank">Twitter</a>, and also find me on <a href="https://github.com/joaomelo" target="_blank">GitHub</a> or <a href="https://www.linkedin.com/in/joaomelo81/?locale=en_US" target="_blank">LinkedIn</a></p>          
        <p class="license">content here is copylefted under <a href="https://choosealicense.com/licenses/cc-by-sa-4.0/" target="_blank">CC-BY-SA-4.0</a></p>
      </footer>
    </div>
  </body>
</html>
