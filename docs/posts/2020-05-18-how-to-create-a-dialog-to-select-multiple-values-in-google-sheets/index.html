<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">

    <style>
        

        /**
        * okaidia theme for JavaScript, CSS and HTML
        * Loosely based on Monokai textmate theme by http://www.monokai.nl/
        * @author ocodia
        */    

        code[class*="language-"],
        pre[class*="language-"] {
          color: #f8f8f2;
          background: none;
          text-shadow: 0 1px rgba(0, 0, 0, 0.3);
          font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
          font-size: 1em;
          text-align: left;
          white-space: pre;
          word-spacing: normal;
          word-break: normal;
          word-wrap: normal;
          line-height: 1.5;

          -moz-tab-size: 4;
          -o-tab-size: 4;
          tab-size: 4;

          -webkit-hyphens: none;
          -moz-hyphens: none;
          -ms-hyphens: none;
          hyphens: none;
        }

        /* Code blocks */
        pre[class*="language-"] {
          padding: 1em;
          margin: .5em 0;
          overflow: auto;
          border-radius: 0.3em;
        }

        :not(pre) > code[class*="language-"],
        pre[class*="language-"] {
          background: #272822;
        }

        /* Inline code */
        :not(pre) > code[class*="language-"] {
          padding: .1em;
          border-radius: .3em;
          white-space: normal;
        }

        .token.comment,
        .token.prolog,
        .token.doctype,
        .token.cdata {
          color: slategray;
        }

        .token.punctuation {
          color: #f8f8f2;
        }

        .token.namespace {
          opacity: .7;
        }

        .token.property,
        .token.tag,
        .token.constant,
        .token.symbol,
        .token.deleted {
          color: #f92672;
        }

        .token.boolean,
        .token.number {
          color: #ae81ff;
        }

        .token.selector,
        .token.attr-name,
        .token.string,
        .token.char,
        .token.builtin,
        .token.inserted {
          color: #a6e22e;
        }

        .token.operator,
        .token.entity,
        .token.url,
        .language-css .token.string,
        .style .token.string,
        .token.variable {
          color: #f8f8f2;
        }

        .token.atrule,
        .token.attr-value,
        .token.function,
        .token.class-name {
          color: #e6db74;
        }

        .token.keyword {
          color: #66d9ef;
        }

        .token.regex,
        .token.important {
          color: #fd971f;
        }

        .token.important,
        .token.bold {
          font-weight: bold;
        }
        .token.italic {
          font-style: italic;
        }

        .token.entity {
          cursor: help;
        }
    </style>

    <title>blog.melo.plus</title>
  </head>
  <body class="bg-green-100 text-gray-700">
    

<div class="min-h-screen max-w-screen-sm mx-auto px-4 bg-white">
  <header class="text-right"><a href="/" target="_self" class="font-semibold text-gray-700 rounded-full hover:text-green-400">home</a></header>
  <main>
    

<article>
  
  <h1 class="text-center text-3xl font-semibold capitalize">How to Create a Dialog to Select Multiple Values in Google Sheets</h1>

  <p class="text-xs text-center"><time datetime="2020-05-18T03:00:00.000Z">May 18, 2020</time></p>
  <div class="mt-4 text-justify">
  <p class="mt-2">Spreadsheets are probably the most ubiquitous digital tool in offices around the world. Most of us have a love and hate relationship with them.</p>
<p class="mt-2">One of the things i missed in then for a long time was the ability to select multiples values for a cell. A emulation of one to many relationships between different data so common in many apps.</p>
<p class="mt-2">Since Google Sheets support scripting using Html and Javascript, it is quite easy to implement that feature in their spreadsheets.</p>
<h2 class="text-xl font-semibold capitalize mt-3">Prepare The Data</h2>
<p class="mt-2">First we create a simple example with sheets for people and teams records. In this case, a person can be in more than one team.</p>
<p class="mt-2">Populate the data in both sheets and set the <em class="text-xs bg-gray-300 font-mono py-1 px-2 rounded-sm not-italic">Data validation</em> option in the people sheet with the teams value range. This link will be vital to our script later.</p>
<p class="mt-2"><img src="data-preparation.gif" alt="data preparation" class="p-4 w-full"></p>
<h2 class="text-xl font-semibold capitalize mt-3">Script Initialization</h2>
<p class="mt-2">Now click in the <em class="text-xs bg-gray-300 font-mono py-1 px-2 rounded-sm not-italic">Script Editor</em> submenu inside the <em class="text-xs bg-gray-300 font-mono py-1 px-2 rounded-sm not-italic">Tools</em> menu. After the script editor screen  opens, click in <em class="text-xs bg-gray-300 font-mono py-1 px-2 rounded-sm not-italic">File</em>, then <em class="text-xs bg-gray-300 font-mono py-1 px-2 rounded-sm not-italic">New</em> and finally in <em class="text-xs bg-gray-300 font-mono py-1 px-2 rounded-sm not-italic">Script file</em>. You can name the file whatever you want, let us stick with <em class="text-xs bg-gray-300 font-mono py-1 px-2 rounded-sm not-italic">index</em>.</p>
<p class="mt-2">Write some code to create a menu option inside the spreadsheet that we can use to call our future dialog. We do that by creating a <em class="text-xs bg-gray-300 font-mono py-1 px-2 rounded-sm not-italic">onOpen</em> function. The name is noted by the spreadsheet and called automatically.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">onOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> ss <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveSpreadsheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> multiselectMenu <span class="token operator">=</span> <span class="token punctuation">{</span> <br>    name<span class="token operator">:</span> <span class="token string">'Select multiple'</span><span class="token punctuation">,</span> <br>    functionName<span class="token operator">:</span> <span class="token string">'showSelectDialog'</span><br>  <span class="token punctuation">}</span><br>  ss<span class="token punctuation">.</span><span class="token function">addMenu</span><span class="token punctuation">(</span><span class="token string">"My Scripts"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>multiselectMenu<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p class="mt-2">After saving the script, you need to reload the spreadsheet window. After that the <em class="text-xs bg-gray-300 font-mono py-1 px-2 rounded-sm not-italic">My Script</em> menu should be available.</p>
<h2 class="text-xl font-semibold capitalize mt-3">Hello World Dialog</h2>
<p class="mt-2">The Apps Scripts technology offers a Html service that can render custom dialogs and sidebars on top of Google office apps. This is great because we can leverage standard Html, CSS and JavaScript together with the Google Api to create a new layer of features above google spreadsheets for example.</p>
<p class="mt-2">Let's create a Html file named <em class="text-xs bg-gray-300 font-mono py-1 px-2 rounded-sm not-italic">dialog</em> in the scripts editor to start exploring this feature. By pasting the code bellow in the <em class="text-xs bg-gray-300 font-mono py-1 px-2 rounded-sm not-italic">dialog</em> file we have a basic custom dialog, but no JavaScript to invoke it.</p>
<pre class="language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Hello World!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <br>      <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cancel<span class="token punctuation">"</span></span> <br>      <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>google.script.host.close()<span class="token punctuation">"</span></span><br>    <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<p class="mt-2">To call the dialog, you need to go back go back to our <em class="text-xs bg-gray-300 font-mono py-1 px-2 rounded-sm not-italic">index</em> file and create a <em class="text-xs bg-gray-300 font-mono py-1 px-2 rounded-sm not-italic">showSelectDialog</em> function. You can see that the function code bellow hints to a template engine capability. This will be very useful to us in a few moments.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">showSelectDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>  <span class="token keyword">const</span> template <span class="token operator">=</span> HtmlService<span class="token punctuation">.</span><span class="token function">createTemplateFromFile</span><span class="token punctuation">(</span><span class="token string">'dialog'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> html <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  SpreadsheetApp<br>    <span class="token punctuation">.</span><span class="token function">getUi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">showModalDialog</span><span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">'Select multiple'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p class="mt-2">If you click in the <em class="text-xs bg-gray-300 font-mono py-1 px-2 rounded-sm not-italic">Select multiple</em> menu our Hello World dialog should appear. Google Sheets maybe ask you for an authorization to run the script. This could happen more then once during this project. Make sure everything sounds safe and click ok.</p>
<p class="mt-2">The challenge now is settle how to show all teams as options for the user to select in the dialog. We can also create a mechanism to check if some teams are already present in the cell show those ones selected in the dialog.</p>
<p class="mt-2">So write another function inside <em class="text-xs bg-gray-300 font-mono py-1 px-2 rounded-sm not-italic">index</em> that uses the validation data for a cell as a database for available options. The function could also check if any of the options are already present in the cell and mark those already as selected. Happily, Apps Scripts Api do most of the heavy lifting for us. See the function.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getOptionsFromCurrentCell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>  <span class="token keyword">const</span> validOptions <span class="token operator">=</span> SpreadsheetApp<br>    <span class="token punctuation">.</span><span class="token function">getActiveRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// everything that is selected</span><br>    <span class="token punctuation">.</span><span class="token function">getDataValidation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// all validation rules for that</span><br>    <span class="token punctuation">.</span><span class="token function">getCriteriaValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// the first criteria</span><br>    <span class="token punctuation">.</span><span class="token function">getValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// the value for this criteria</span><br>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=></span> value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// flatten in an one dimension array</span><br><br>  <span class="token keyword">const</span> cellData <span class="token operator">=</span> SpreadsheetApp<br>    <span class="token punctuation">.</span><span class="token function">getActiveRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// first selected cell in the range</span><br>    <span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> selectedOptions <span class="token operator">=</span> cellData<br>    <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">str</span> <span class="token operator">=></span> str<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <br>  <span class="token keyword">const</span> optionsData <span class="token operator">=</span> validOptions<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">option</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token punctuation">{</span><br>      value<span class="token operator">:</span> option<span class="token punctuation">,</span><br>      isSelected<span class="token operator">:</span> selectedOptions<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>  <span class="token keyword">return</span> optionsData<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p class="mt-2">The Apps Script template engine let us inject data in templates that can be used inside the html. We can take advantage of that and update our <code>showSelectDialog</code> function to setup the options before calling the dialog.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">showSelectDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>  <span class="token keyword">const</span> template <span class="token operator">=</span> HtmlService<span class="token punctuation">.</span><span class="token function">createTemplateFromFile</span><span class="token punctuation">(</span><span class="token string">'dialog'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  template<span class="token punctuation">.</span>optionsData <span class="token operator">=</span> <span class="token function">getOptionsFromCurrentCell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> html <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  SpreadsheetApp<br>    <span class="token punctuation">.</span><span class="token function">getUi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">showModalDialog</span><span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">'Select multiple'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p class="mt-2">Now we need to use that data inside out html to render checkboxes for every option. The template engine cares similar behavior then other typical templates javascript languages. Details can be found <a href="https://developers.google.com/apps-script/guides/html/templates">here</a>.</p>
<p class="mt-2">Let's revisit the html to render the checkboxes. and also create a function to clear or select all items.</p>
<pre class="language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token prolog">&lt;? for (const option of optionsData) { ?></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;?= option.value ?><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>option<span class="token punctuation">"</span></span> <span class="token attr-name">&lt;?</span><span class="token attr-value"><span class="token punctuation">=</span> option.isSelected</span> <span class="token attr-name">&amp;&amp;</span> <span class="token attr-name">"checked"</span> <span class="token attr-name">?</span><span class="token punctuation">></span></span>><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span><span class="token prolog">&lt;?= option.value ?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><br>    <span class="token prolog">&lt;? } ?></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">margin-top</span><span class="token punctuation">:</span>10px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>all<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setAll('check')<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>clear<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setAll('clear')<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cancel<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>google.script.host.close()<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">      <br>      <span class="token keyword">function</span> <span class="token function">setAll</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> optionsEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">".option"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> checkbox <span class="token keyword">of</span> optionsEl<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          checkbox<span class="token punctuation">.</span>checked <span class="token operator">=</span> value <span class="token operator">===</span> <span class="token string">'check'</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<p class="mt-2">Things are starting to get real. But we need to find a way to send the user selected options back to the spreadsheet. Google consider the dialog we develop as a client app and both the spreadsheet itself and the functions we wrote in the <code>index</code> file as the server part. So we need a bridge to comunicate back what the user selected. Gladly this is quite simple.</p>
<p class="mt-2">First let's write a new function in the index file that receives a array of choices as parameter and set that content in the current selected cell.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">setOptionsForCurrentCell</span><span class="token punctuation">(</span><span class="token parameter">selectedOptions</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>  <span class="token keyword">const</span> cellData <span class="token operator">=</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>selectedOptions<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> selectedOptions<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <br>    <span class="token operator">?</span> selectedOptions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span> <br>    <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> cell <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  cell<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>cellData<span class="token punctuation">)</span><span class="token punctuation">;</span>  <br><span class="token punctuation">}</span></code></pre>
<p class="mt-2">Now we have to update out html file to create a apply button and create function that evokes the set function passing the selected options.</p>
<pre class="language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token prolog">&lt;? for (const option of optionsData) { ?></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>option<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;?= option.value ?><span class="token punctuation">"</span></span> <span class="token attr-name">&lt;?</span><span class="token attr-value"><span class="token punctuation">=</span> option.isSelected</span> <span class="token attr-name">&amp;&amp;</span> <span class="token attr-name">"checked"</span> <span class="token attr-name">?</span><span class="token punctuation">></span></span>><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span><span class="token prolog">&lt;?= option.value ?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><br>    <span class="token prolog">&lt;? } ?></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">margin-top</span><span class="token punctuation">:</span>10px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>all<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setAll('check')<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>clear<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setAll('clear')<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cancel<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>google.script.host.close()<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>apply<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>apply()<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">      <br>      <span class="token keyword">function</span> <span class="token function">setAll</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> optionsEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">".option"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> checkbox <span class="token keyword">of</span> optionsEl<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          checkbox<span class="token punctuation">.</span>checked <span class="token operator">=</span> value <span class="token operator">===</span> <span class="token string">'check'</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><br><br>      <span class="token keyword">function</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>        <span class="token keyword">const</span> checkedEls <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">".option:checked"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">const</span> selectedValues <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> checkbox <span class="token keyword">of</span> checkedEls<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token keyword">if</span> <span class="token punctuation">(</span>checkbox<span class="token punctuation">.</span>checked<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>             selectedValues<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>checkbox<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>        google<span class="token punctuation">.</span>script<span class="token punctuation">.</span>run<span class="token punctuation">.</span><span class="token function">setOptionsForCurrentCell</span><span class="token punctuation">(</span>selectedValues<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        google<span class="token punctuation">.</span>script<span class="token punctuation">.</span>host<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<p class="mt-2">You can can see in the <code>apply</code> function we called <code>setOptionsForCurrentCell</code> via <code>google.script.run</code>. Take note this is a asynchronous operation. The run operation offers other options as handlers for failed or success calls. You can read more about that <a href="https://developers.google.com/apps-script/guides/html/reference/run">here</a>.</p>
<p class="mt-2">By now our dialog should be working just fine even if not so elegant designed.</p>
<p class="mt-2"><img src="dialog-working.gif" alt="dialog is now working" class="p-4 w-full"></p>
<p class="mt-2">We can improve upon that by styling the dialog and creating a better UI. You will see that if click in the menu in a cell without validation criteria we get a exception. We also could deal better with the asynchronous aspects. But i will leave that outside the scope of this post.</p>
<p class="mt-2">Finally, you can find the full code for this post in this (GitHub repository)[<a href="https://github.com/joaomelo/dialog-to-select-multiple-values-in-google-sheets">https://github.com/joaomelo/dialog-to-select-multiple-values-in-google-sheets</a>].</p>

  </div>
</article>
  </main>
  <footer>
    <section class="mt-8 flex flex-wrap justify-center">
      
        
  <a href="/tags/google apps script/" class="font-semibold text-gray-700 rounded-full bg-green-200 hover:bg-green-400 px-2 mx-1 my-1">google apps script</a>
      
    </section>
    <p class="mt-8 mx-8 p-4 text-justify font-mono border-dashed border-4 border-gray-700">Hi! Me name is JoÃ£o Melo. I am an enthusiast of how leadership and technology combine to create amazing things together ðŸ¤“. I decided to blog about it as I learn what I can. You can get updates from <a href="https://twitter.com/joaomeloplus" target="_blank" class="font-semibold text-gray-700 rounded-full hover:text-green-400">Twitter</a> or <a href="https://www.linkedin.com/in/joaomelo81/?locale=en_US" target="_blank" class="font-semibold text-gray-700 rounded-full hover:text-green-400">LinkedIn</a>, and also find me on <a href="https://github.com/joaomelo" target="_blank" class="font-semibold text-gray-700 rounded-full hover:text-green-400">GitHub</a></p>
    <p class="text-center mt-8 text-xs">content here is copylefted under <a href="https://choosealicense.com/licenses/cc-by-sa-4.0/" target="_blank" class="font-semibold text-gray-700 rounded-full hover:text-green-400">CC-BY-SA-4.0</a></p>
    <br/>
  </footer>
</div>

  </body>
</html>