<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">

    <style>
        

        /**
        * okaidia theme for JavaScript, CSS and HTML
        * Loosely based on Monokai textmate theme by http://www.monokai.nl/
        * @author ocodia
        */    

        code[class*="language-"],
        pre[class*="language-"] {
          color: #f8f8f2;
          background: none;
          text-shadow: 0 1px rgba(0, 0, 0, 0.3);
          font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
          font-size: 1em;
          text-align: left;
          white-space: pre;
          word-spacing: normal;
          word-break: normal;
          word-wrap: normal;
          line-height: 1.5;

          -moz-tab-size: 4;
          -o-tab-size: 4;
          tab-size: 4;

          -webkit-hyphens: none;
          -moz-hyphens: none;
          -ms-hyphens: none;
          hyphens: none;
        }

        /* Code blocks */
        pre[class*="language-"] {
          padding: 1em;
          margin: .5em 0;
          overflow: auto;
          border-radius: 0.3em;
        }

        :not(pre) > code[class*="language-"],
        pre[class*="language-"] {
          background: #272822;
        }

        /* Inline code */
        :not(pre) > code[class*="language-"] {
          padding: .1em;
          border-radius: .3em;
          white-space: normal;
        }

        .token.comment,
        .token.prolog,
        .token.doctype,
        .token.cdata {
          color: slategray;
        }

        .token.punctuation {
          color: #f8f8f2;
        }

        .token.namespace {
          opacity: .7;
        }

        .token.property,
        .token.tag,
        .token.constant,
        .token.symbol,
        .token.deleted {
          color: #f92672;
        }

        .token.boolean,
        .token.number {
          color: #ae81ff;
        }

        .token.selector,
        .token.attr-name,
        .token.string,
        .token.char,
        .token.builtin,
        .token.inserted {
          color: #a6e22e;
        }

        .token.operator,
        .token.entity,
        .token.url,
        .language-css .token.string,
        .style .token.string,
        .token.variable {
          color: #f8f8f2;
        }

        .token.atrule,
        .token.attr-value,
        .token.function,
        .token.class-name {
          color: #e6db74;
        }

        .token.keyword {
          color: #66d9ef;
        }

        .token.regex,
        .token.important {
          color: #fd971f;
        }

        .token.important,
        .token.bold {
          font-weight: bold;
        }
        .token.italic {
          font-style: italic;
        }

        .token.entity {
          cursor: help;
        }
    </style>

    <title>blog.melo.plus</title>
  </head>
  <body class="bg-green-100 text-gray-700">
    

<div class="min-h-screen max-w-screen-sm mx-auto px-4 bg-white">
  <header class="text-right"><a href="/" target="_self" class="font-semibold text-gray-700 rounded-full hover:text-green-400">home</a></header>
  <main>
    

<article>
  
  <h1 class="text-center text-3xl font-semibold capitalize">How to Create a Dialog to Select Multiple Values in Google Sheets</h1>

  <p class="text-xs text-center"><time datetime="2020-05-11T22:22:58.052Z">May 11, 2020</time></p>
  <div class="mt-4 text-justify">
  <p class="mt-2">Spreadsheets are the probably the most ubiquitous digital tool in the offices around the world. Most of us have a love and hate relationship with them.</p>
<p class="mt-2">One of the things missed for a long tim in then is the ability to select multiples values for a cell. Someway to emulate one to many relationships between different sheets.</p>
<p class="mt-2">Since Google Sheets support scripting using Html and Javascript it is quite easy to implement that feature in a spreadsheet.</p>
<h2 class="text-xl font-semibold capitalize mt-3">Prepare The Data</h2>
<p class="mt-2">Let's create a simple example with people and team sheets. In this casa a person can be in more than one team.</p>
<p class="mt-2">We populate the data in both sheets and a important detail, link the Data Validation option in the people sheet towards the teams value. This link will be used by our script later.</p>
<p class="mt-2"><img src="data-preparation.gif" alt="data preparation" class="p-4 w-full"></p>
<h2 class="text-xl font-semibold capitalize mt-3">Script Initialization</h2>
<p class="mt-2">After that you can click in <code>Script Editor</code> submenu inside the <code>Tools</code> menu. After the script editor screen opens you click in <code>File</code>, then <code>New</code> and finally <code>Script file</code>. Name it <code>index</code>.</p>
<p class="mt-2">The first step is to create a menu option inside the spreadsheet we can use to call our dialog. We do that by creating a <code>onOpen</code> function. This will be called automatically.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">onOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> ss <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveSpreadsheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> multiselectMenu <span class="token operator">=</span> <span class="token punctuation">{</span> <br>    name<span class="token operator">:</span> <span class="token string">'Select multiple'</span><span class="token punctuation">,</span> <br>    functionName<span class="token operator">:</span> <span class="token string">'showSelectDialog'</span><br>  <span class="token punctuation">}</span><br>  ss<span class="token punctuation">.</span><span class="token function">addMenu</span><span class="token punctuation">(</span><span class="token string">"My Scripts"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>multiselectMenu<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p class="mt-2">After saving the script, you can reload the spreadsheet window and the <code>My Script</code> menu should already be available.</p>
<h2 class="text-xl font-semibold capitalize mt-3">Apps Scripts Dialog</h2>
<p class="mt-2">The Apps Scripts technology offers a Html service that can render custom dialog and sidebars on top of google apps. We leverage standard html, css and javascript together with google Api to create custom behavior in google spreadsheets for example.</p>
<p class="mt-2">Let's create a html file named <code>dialog</code> in the scripts editor to start exploring this feature. Paste the code bellow in the new file.</p>
<pre class="language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Hello World!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <br>      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <br>      <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cancel<span class="token punctuation">"</span></span> <br>      <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>google.script.host.close()<span class="token punctuation">"</span></span><br>    <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<p class="mt-2">Now to call a dialog with this html we go back to our <code>index</code> file and add the <code>showSelectDialog</code> function with the code bellow. You can see the code hints to a template engine capability inside Apps Script. This will be useful to us later.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">showSelectDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>  <span class="token keyword">const</span> template <span class="token operator">=</span> HtmlService<span class="token punctuation">.</span><span class="token function">createTemplateFromFile</span><span class="token punctuation">(</span><span class="token string">'dialog'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> html <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  SpreadsheetApp<br>    <span class="token punctuation">.</span><span class="token function">getUi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">showModalDialog</span><span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">'Select multiple'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p class="mt-2">You should now be seeing a basic dialog when clicking in <code>Select multiple</code>. Google Sheets maybe ask you for authorization to run the script. This could happen more then one time during this project. You can say ok and go.</p>
<p class="mt-2">The first challenge we have is how to show all teams options the user can select and if some are already present in the cell, present then already selected. So let's write another function inside <code>index</code> that grab the validation data for a cell as the database for available options and mark those already selected. See:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getOptionsFromCurrentCell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>  <span class="token keyword">const</span> validOptions <span class="token operator">=</span> SpreadsheetApp<br>    <span class="token punctuation">.</span><span class="token function">getActiveRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">getDataValidation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">getCriteriaValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><br>    <span class="token punctuation">.</span><span class="token function">getValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=></span> value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> cellData <span class="token operator">=</span> SpreadsheetApp<br>    <span class="token punctuation">.</span><span class="token function">getActiveRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// first selected cell in the range</span><br>    <span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> selectedOptions <span class="token operator">=</span> cellData<br>    <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">str</span> <span class="token operator">=></span> str<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <br>  <span class="token keyword">const</span> optionsData <span class="token operator">=</span> validOptions<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">option</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token punctuation">{</span><br>      value<span class="token operator">:</span> option<span class="token punctuation">,</span><br>      isSelected<span class="token operator">:</span> selectedOptions<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>  <span class="token keyword">return</span> optionsData<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p class="mt-2">The Apps Script template engine let us inject data in templates that can be used inside the html. We can take advantage of that and update our <code>showSelectDialog</code> function to setup the options before calling the dialog.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">showSelectDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>  <span class="token keyword">const</span> template <span class="token operator">=</span> HtmlService<span class="token punctuation">.</span><span class="token function">createTemplateFromFile</span><span class="token punctuation">(</span><span class="token string">'dialog'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  template<span class="token punctuation">.</span>optionsData <span class="token operator">=</span> <span class="token function">getOptionsFromCurrentCell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> html <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  SpreadsheetApp<br>    <span class="token punctuation">.</span><span class="token function">getUi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">showModalDialog</span><span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">'Select multiple'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p class="mt-2">Now we need to use that data inside out html to render checkboxes for every option. The template engine cares similar behavior then other typical templates javascript languages. Details can be found <a href="https://developers.google.com/apps-script/guides/html/templates">here</a>.</p>
<p class="mt-2">Let's revisit the html to render the checkboxes. and also create a function to clear or select all items.</p>
<pre class="language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token prolog">&lt;? for (const option of optionsData) { ?></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;?= option.value ?><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>option<span class="token punctuation">"</span></span> <span class="token attr-name">&lt;?</span><span class="token attr-value"><span class="token punctuation">=</span> option.isSelected</span> <span class="token attr-name">&amp;&amp;</span> <span class="token attr-name">"checked"</span> <span class="token attr-name">?</span><span class="token punctuation">></span></span>><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span><span class="token prolog">&lt;?= option.value ?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><br>    <span class="token prolog">&lt;? } ?></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">margin-top</span><span class="token punctuation">:</span>10px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>all<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setAll('check')<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>clear<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setAll('clear')<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cancel<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>google.script.host.close()<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">      <br>      <span class="token keyword">function</span> <span class="token function">setAll</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> optionsEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">".option"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> checkbox <span class="token keyword">of</span> optionsEl<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          checkbox<span class="token punctuation">.</span>checked <span class="token operator">=</span> value <span class="token operator">===</span> <span class="token string">'check'</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<p class="mt-2">Things are starting to get real. But we need to find a way to send the user selected options back to the spreadsheet. Google consider the dialog we develop as a client app and both the spreadsheet itself and the functions we wrote in the <code>index</code> file as the server part. So we need a bridge to comunicate back what the user selected. Gladly this is quite simple.</p>
<p class="mt-2">First let's write a new function in the index file that receives a array of choices as parameter and set that content in the current selected cell.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">setOptionsForCurrentCell</span><span class="token punctuation">(</span><span class="token parameter">selectedOptions</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>  <span class="token keyword">const</span> cellData <span class="token operator">=</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>selectedOptions<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> selectedOptions<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <br>    <span class="token operator">?</span> selectedOptions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span> <br>    <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> cell <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCell</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  cell<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>cellData<span class="token punctuation">)</span><span class="token punctuation">;</span>  <br><span class="token punctuation">}</span></code></pre>
<p class="mt-2">Now we have to update out html file to create a apply button and create function that evokes the set function passing the selected options.</p>
<pre class="language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token prolog">&lt;? for (const option of optionsData) { ?></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>option<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>&lt;?= option.value ?><span class="token punctuation">"</span></span> <span class="token attr-name">&lt;?</span><span class="token attr-value"><span class="token punctuation">=</span> option.isSelected</span> <span class="token attr-name">&amp;&amp;</span> <span class="token attr-name">"checked"</span> <span class="token attr-name">?</span><span class="token punctuation">></span></span>><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span><span class="token prolog">&lt;?= option.value ?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><br>    <span class="token prolog">&lt;? } ?></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">margin-top</span><span class="token punctuation">:</span>10px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>all<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setAll('check')<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>clear<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setAll('clear')<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cancel<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>google.script.host.close()<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>apply<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>apply()<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">      <br>      <span class="token keyword">function</span> <span class="token function">setAll</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> optionsEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">".option"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> checkbox <span class="token keyword">of</span> optionsEl<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          checkbox<span class="token punctuation">.</span>checked <span class="token operator">=</span> value <span class="token operator">===</span> <span class="token string">'check'</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><br><br>      <span class="token keyword">function</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>        <span class="token keyword">const</span> checkedEls <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">".option:checked"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">const</span> selectedValues <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> checkbox <span class="token keyword">of</span> checkedEls<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token keyword">if</span> <span class="token punctuation">(</span>checkbox<span class="token punctuation">.</span>checked<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>             selectedValues<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>checkbox<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>        google<span class="token punctuation">.</span>script<span class="token punctuation">.</span>run<span class="token punctuation">.</span><span class="token function">setOptionsForCurrentCell</span><span class="token punctuation">(</span>selectedValues<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        google<span class="token punctuation">.</span>script<span class="token punctuation">.</span>host<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<p class="mt-2">You can can see in the <code>apply</code> function we called <code>setOptionsForCurrentCell</code> via <code>google.script.run</code>. Take note this is a asynchronous operation. The run operation offers other options as handlers for failed or success calls. You can read more about that <a href="https://developers.google.com/apps-script/guides/html/reference/run">here</a>.</p>
<p class="mt-2">By now our dialog should be working just fine even if not so elegant designed.</p>
<p class="mt-2"><img src="dialog-working.gif" alt="dialog is now working" class="p-4 w-full"></p>
<p class="mt-2">We can improve upon that by styling the dialog and creating a better UI. You will see that if click in the menu in a cell without validation criteria we get a exception. We also could deal better with the asynchronous aspects. But i will leave that outside the scope of this post.</p>
<p class="mt-2">Finally, you can find the full code mentioned here in this GitHub repository.</p>

  </div>
</article>
  </main>
  <footer>
    <section class="mt-8 flex flex-wrap justify-center">
      
    </section>
    <p class="mt-8 mx-8 p-4 text-justify font-mono border-dashed border-4 border-gray-700">Hi! Me name is JoÃ£o Melo. I am an enthusiast of how leadership and technology combine to create amazing things together ðŸ¤“. I decided to blog about it as I learn what I can. You can get updates from <a href="https://twitter.com/joaomeloplus" target="_blank" class="font-semibold text-gray-700 rounded-full hover:text-green-400">Twitter</a> or <a href="https://www.linkedin.com/in/joaomelo81/?locale=en_US" target="_blank" class="font-semibold text-gray-700 rounded-full hover:text-green-400">LinkedIn</a>, and also find me on <a href="https://github.com/joaomelo" target="_blank" class="font-semibold text-gray-700 rounded-full hover:text-green-400">GitHub</a></p>
    <p class="text-center mt-8 text-xs">content here is copylefted under <a href="https://choosealicense.com/licenses/cc-by-sa-4.0/" target="_blank" class="font-semibold text-gray-700 rounded-full hover:text-green-400">CC-BY-SA-4.0</a></p>
    <br/>
  </footer>
</div>

  </body>
</html>